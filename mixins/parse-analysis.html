<script>
  
(()=> {
  'use strict';

  if (!window.Zecat) window.Zecat = {};

  /**
   * 
   * 
   * @polymer
   * @mixinFunction
   */
  Zecat.ParseAnalysis = (superClass) => class extends superClass {

    constructor() {
      super();
    }

    connectedCallback() {
      super.connectedCallback();
    }

    disconnectedCallback() {
      super.disconnectedCallback();
    }

    get emptySandboxDescriptor() {
      return {
        properties: {
          boolean: [],
          string: [],
          number: [],
          object: [],
          function: []
        },
        events: [],
        methods: []
      };
    }

    parseAnalysis(analysis) {
      let descriptor = this.emptySandboxDescriptor;

      for (let {type, name, defaultValue, description, privacy, metadata} of analysis.properties) {
        // Array and Object types are uppercase
        type = type.toLowerCase();
        if (!descriptor.properties[type]) {
          descriptor.properties[type] = [];
        }
        if (defaultValue !== undefined) {
          try {
            defaultValue = JSON.parse(defaultValue);
          } catch(e) {
            defaultValue = undefined;
          }
        }
        // v.observer.substring(1, v.observer.length - 1);
        let propertyDescriptor = {
          name,
          description,
          privacy,
          defaultValue,
          value: defaultValue
        };
        if (metadata.polymer && Object.keys(metadata.polymer).length) {
          // assign any polymer metadata (notify, readOnly...)
          propertyDescriptor = Object.assign(propertyDescriptor, metadata.polymer);
        }
        descriptor.properties[type].push(propertyDescriptor);
      }
      for (let {name, description, params, privacy} of analysis.methods) {
        descriptor.methods.push({
          name,
          description,
          params: params.map(p => Object.assign(p, {value: undefined})),
          privacy
        });
      }
      for (let {name, description} of analysis.events) {
        descriptor.events.push({name, description});
      }
      Object.assign(descriptor, {styling: analysis.styling, slots: analysis.slots, tagname: analysis.tagname});
      
      return descriptor;
    }

  };
})();
  

</script>