<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../polymer/lib/mixins/gesture-event-listeners.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-tooltip/paper-tooltip.html">
<link rel="import" href="../paper-badge/paper-badge.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-listbox/paper-listbox.html">
<link rel="import" href="../paper-menu-button/paper-menu-button.html">
<link rel="import" href="../paper-menu-button/paper-menu-button-animations.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../neon-animation/web-animations.html">

<dom-module id="paper-sandbox-method">
  <template strip-whitespace>
    <style>
      :host {
        @apply --layout-horizontal;
      }
       paper-badge {
        --paper-badge-background: transparent;
        --paper-badge-text-color: black;
        --paper-badge-margin-left: -2px;
        --paper-badge-margin-bottom: -2px;
      }
      #methodButton, #methodParamsButton {
        background: white;
        position: relative;
        padding-top: 0;
        padding-bottom: 0;
        height: 40px;
      }
      #methodButton {
        margin: 0;
        border-radius: 3px 0 0 3px ;
        @apply --layout-flex;
      }
      #methodParamsButton {
        border-radius: 0 3px 3px 0;
        margin: 0;
        background: white;
        min-width: 40px;
      }
      #paramsMenuButton {
        padding: 0;
      }
      :host > [pressed] {
        z-index: 1;
        border-radius: 3px;
      }
      paper-listbox {
        width: 200px;
      }
    </style>

    <paper-button
        id="methodButton"
        raised
        on-tap="_triggerButtonTapHandler">
      [[_uppercaseToSpace(name)]]
      <paper-tooltip>[[description]]</paper-tooltip>
    </paper-button>

    <template is="dom-if" if="[[params.length]]">
      <paper-menu-button
          id="paramsMenuButton"
          restore-focus-on-close
          ignore-select
          no-overlap
          horizontal-align="right"
          vertical-offset="4">
        <paper-button
            id="methodParamsButton"
            slot="dropdown-trigger"
            raised>
          <iron-icon id="params" icon="settings"></iron-icon>
          <paper-badge for="params" label="[[params.length]]"></paper-badge>
        </paper-button>
        <paper-listbox slot="dropdown-content">
          <template is="dom-repeat" items="[[params]]">
            <paper-item>
              <paper-input
                  label="[[item.name]]"
                  value="{{item.value}}">
              </paper-input>
            </paper-item>
          </template>
        </paper-listbox>
      </paper-menu-button>
    </template>

  </template>

  <script>
    /**
     * Missing Description
     *
     * @appliesMixin Polymer.GestureEventListeners
     * @customElement
     * @polymer
     */
    class PaperSandboxMethod extends Polymer.GestureEventListeners(Polymer.Element) {

      static get is() { return 'paper-sandbox-method'; }

      static get properties() {
        return {
          name: String,
          description: String,
          params: {
            type: Array,
            notify: true
          }
        };
      }

      _uppercaseToSpace(value) {
        return value.replace( /([A-Z])/g, " $1" );
      }

      _triggerButtonTapHandler() {
        this.dispatchEvent(
          new CustomEvent(
            'method-triggered', {
              detail: {
                name: this.name,
                params: this.params
              },
              bubbles:
              true, composed: true
            }));
      }
    }

    window.customElements.define(PaperSandboxMethod.is, PaperSandboxMethod);

  </script>
</dom-module>
