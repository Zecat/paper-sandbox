<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../shadycss/apply-shim.html">
<link rel="import" href="../app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="../app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../paper-styles/shadow.html">
<link rel="import" href="../paper-toast/paper-toast.html">
<link rel="import" href="../paper-fab/paper-fab.html">
<link rel="import" href="paper-sandbox-icons.html">
<link rel="import" href="paper-sandbox.html">

<dom-module id="paper-sandboxer">
  <template>
    <style>
      :host {
        display: block;
        @apply --layout-vertical;
        --app-drawer-width: 800px;
        --app-drawer-content-container: {
          max-width: 100%;
        }
      }
      app-drawer {
        border-right: 1px solid var(--paper-grey-200);
      }
      paper-sandbox {
        overflow: auto;
        height: 100%;
      }
      paper-fab {
        z-index: 1;
        position: fixed;
        bottom: 24px;
        right: 24px;
        @apply --shadow-transition;
      }
      #errorToast {
        --paper-toast-background-color: var(--paper-red-500);
        --paper-toast-color: white;
      }
    </style>

    <paper-toast id="errorToast"></paper-toast>
    
    <template is="dom-if" if="[[narrow]]">
      <paper-fab
        icon="[[_computeFabIcon(drawerOpened)]]"
        on-tap="toggleDrawer">
      </paper-fab>
    </template>

    <app-drawer-layout
        responsive-width="1100px"
        narrow="{{narrow}}">
      <app-drawer id="drawer" slot="drawer"
          swipe-open
          opened="{{drawerOpened}}">
        <paper-sandbox id="sandbox"></paper-sandbox>
      </app-drawer>
      <div>
        <slot id="slot" on-slotchange="_slotChangeHandler"></slot>
      </div>
    </app-drawer-layout>

  </template>


  <script>
    /**
     *
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class PaperSandboxer extends Polymer.Element {

      static get is() { return 'paper-sandboxer'; }

      static get properties() {
        return {
          /**
           * The tag name of the element you want to produce a sandbox for.
           * @type {String}
           */
          tag: String,
          drawerOpened: Boolean,
          narrow: Boolean
        };
      }

      constructor() {
        super();
        this._handleAnalysisError_boundListener = this._handleAnalysisError.bind(this);
        this.addEventListener('analysis-error', this._handleAnalysisError_boundListener);
      }

      disconnectedCallback() {
        this.removeEventListener('analysis-error', this._handleAnalysisError_boundListener);
      }

      _handleAnalysisError(e) {
        this.$.errorToast.show({text: e.detail.description, duration: 0});
      }

      _slotChangeHandler() {
        this.$.sandbox.analyzedElement = this.querySelector(this.tag);
      }

      toggleDrawer() {
        this.$.drawer.toggle();
      }

      _computeFabIcon(drawerOpened) {
        return drawerOpened ? 'sandbox:auto-fix' : 'sandbox:experiment';
      }

    }

    customElements.define(PaperSandboxer.is, PaperSandboxer);

  </script>
</dom-module>
