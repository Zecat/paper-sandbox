<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../shadycss/apply-shim.html">
<link rel="import" href="../polymer/lib/utils/templatize.html">
<link rel="import" href="paper-sandbox.html">

<dom-module id="paper-sandboxer">
  <template>
    <style>
      :host {
        display: block;
        @apply --layout-vertical;
      }
      #demoContainer {
        @apply --paper-sandbox-demo-container;
        @apply --layout-center;
        max-width: 300px;
        margin: 42px auto;
      }
      paper-sandbox {
        position: fixed;
        top: 0;
        left: 0;
        overflow: auto;
        height: 100vh;
      }
    </style>

    <slot id="slot" on-slotchange="_slotChangeHandler"></slot>

    <div id="demoContainer"></div>

    <paper-sandbox id="sandbox"></paper-sandbox>

  </template>


  <script>
    /**
     * 
     * 
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class PaperSandboxer extends Polymer.Element {

      static get is() { return 'paper-sandboxer'; }

      static get properties() {
        return {
          /**
           * The tag name of the element you want to produce a sandbox for.
           * @type {String}
           */
          tag: String
        };
      }

      constructor() {
        super();
      }

      connectedCallback() {
        super.connectedCallback();
      }

      disconnectedCallback() {
        super.disconnectedCallback();
      }

      ready() {
        super.ready();
        this._assignedNodesChange(this.$.slot.assignedNodes({flatten: true}));
      }

      _slotChangeHandler(e) {
        this._assignedNodesChange(e.target.assignedNodes({flatten: true}));
      }

      _assignedNodesChange(assignedNodes) {
        if (!assignedNodes) return;

        // Find the first template 
        const template = assignedNodes.find(n => n.nodeName === 'TEMPLATE');
        if (!template) return;
        
        this.ctr = Polymer.Templatize.templatize(template, this);
        this.stamped = new this.ctr({});

        this.$.demoContainer.appendChild(this.stamped.root);
        
        this.$.sandbox.analyzedElement = this.$.demoContainer.querySelector(this.tag);
      }
    }

    customElements.define(PaperSandboxer.is, PaperSandboxer);
    

  </script>
</dom-module>