<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-toggle-button/paper-toggle-button.html">
<link rel="import" href="../paper-tooltip/paper-tooltip.html">
<link rel="import" href="../paper-badge/paper-badge.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../paper-checkbox/paper-checkbox.html">
<link rel="import" href="../paper-styles/typography.html">

<!--
`sandbox-configuration`


@demo demo/static.html
-->

<dom-module id="sandbox-configuration">
  <template strip-whitespace>
    <style>
      :host {
        display: block;
      }
      #bindedProps {
        @apply --layout-horizontal;
      }
      .vertical {
        @apply --layout-vertical;
      }
      .subheader {
        @apply --paper-font-subhead;
      }
      
      iron-icon {
        /* border-left: 1px solid #d8d8d8; */
        /* margin-left: 10px; */
      }
       paper-badge {
        --paper-badge-background: transparent;
        --paper-badge-text-color: black;
        --paper-badge-margin-left: -2px;
        --paper-badge-margin-bottom: -2px;
      }
      .methodButtonGroup {
        @apply --layout-horizontal;
      }
      .methodButtonGroup > * {
        margin: 20px 0;
        background: white;
        position: relative;
        padding-top: 0;
        padding-bottom: 0;
        height: 40px;
      }
      .methodButtonGroup > :first-child {
        margin-right: 0; 
        border-radius: 3px 0 0 3px ;
        @apply --layout-flex;
      }
      .method-settings {
        border-radius: 0 3px 3px 0;
        margin-left: 0;
        background: white;
        min-width: 40px;
      }
      .methodButtonGroup > [pressed] {
        z-index: 1;
        border-radius: 3px;
      }
    </style>

    <!-- TODO: give the tooltips a better style using prism-hightlighter -->
    <div id="bindedProps">

      <template is="dom-if" if="[[configuration.methods.length]]">
        <div class="vertical methods">
          <div class="subheader">Methods</div>
          <template
            is="dom-repeat"
            items="{{configuration.methods}}"
            filter="[[filterFn]]"
          >
            <div class="methodButtonGroup">
              <paper-button raised>
                [[_uppercaseToSpace(item.name)]]
                <paper-tooltip>[[item.description]]</paper-tooltip>
              </paper-button>
              <template is="dom-if" if="[[item.params.length]]">
                <paper-button raised class="method-settings">
                  <iron-icon id$="method-[[item.name]]-params" icon="settings" on-tap="_stopEventPropagation">
                  </iron-icon>
                  <paper-badge for$="method-[[item.name]]-params" label="[[item.params.length]]"></paper-badge>
                </paper-button>
              </template>
            </div>
            <!-- <paper-button raised on-tap="_handleFunctionButtonTap">
            <span>[[_uppercaseToSpace(item.name)]]<paper-tooltip>[[item.description]]</paper-tooltip></span>
            <template is="dom-if" if="[[item.params.length]]">
              <paper-icon-button id$="method-[[item.name]]-params" icon="settings" on-tap="_stopEventPropagation">
              </paper-icon-button>
              <paper-badge for="method-[[item.name]]-params" label="[[item.params.length]]"></paper-badge>
            </template>
            <paper-tooltip>
              <template
                is="dom-repeat"
                items="[[item.params]]" as="param">
                [[param.description]]<br>
                [[param.name]]<br>
                [[param.type]]
              </template>
            </paper-tooltip> -->
            <!-- TODO: Use a dropdown to display the response -->
            <!-- <paper-icon-button on-tap="_handleFunctionButtonTap" icon="send"></paper-icon-button>[[item.lastResponse]] -->
          </paper-button>
          </template>
        </div>
      </template>

      <template is="dom-if" if="[[configuration.properties.boolean.length]]">
        <div class="vertical">
          <div class="subheader">Boolean properties</div>
          <template
            is="dom-repeat"
            items="{{configuration.properties.boolean}}"
            filter="[[filterFn]]"
          >
            <paper-item>
              <paper-checkbox checked="{{item.value}}">[[_toHyphen(item.name)]]</paper-checkbox>
              <paper-tooltip>[[item.description]]</paper-tooltip>
            </paper-item>
          </template>
        </div>
      </template>

      <template is="dom-if" if="[[configuration.properties.string.length]]">
        <div class="vertical">
          <div class="subheader">String properties</div>
          <template
            is="dom-repeat"
            items="{{configuration.properties.string}}"
            filter="[[filterFn]]"
          >
            <paper-item>
            <paper-input label="[[_toHyphen(item.name)]]" value="{{item.value}}"></paper-input>
            <paper-tooltip>[[item.description]]</paper-tooltip>
          </paper-item>
          </template>
        </div>
      </template>

      <template is="dom-if" if="[[configuration.properties.number.length]]">
        <div class="vertical">
          <div class="subheader">Number properties</div>
          <template
            is="dom-repeat"
            items="{{configuration.properties.number}}"
            filter="[[filterFn]]"
          >
            <paper-item>
            <paper-input label="[[_toHyphen(item.name)]]" value="{{item.value}}"></paper-input>
            <paper-tooltip>[[item.description]]</paper-tooltip>
          </paper-item>
          </template>
        </div>
      </template>

      <template is="dom-if" if="[[configuration.event.length]]">
        <div class="vertical">
          <div class="subheader">Events</div>
          <template
            is="dom-repeat"
            items="{{configuration.event}}"
          >
            <paper-item>
              [[item.name]]
              <paper-tooltip>[[item.description]]</paper-tooltip>
            </paper-item>
          </template>
        </div>
      </template>

      <template is="dom-if" if="[[configuration.event.length]]">
        <div class="vertical">
          <div class="subheader">Events fired</div>
          <template
            is="dom-repeat"
            items="{{configuration.fired}}"
          >
            <paper-item>
              [[item.name]]
              <paper-tooltip>[[item.detail]]</paper-tooltip>
            </paper-item>
          </template>
        </div>
      </template>

      <template is="dom-if" if="[[configuration.promise]]">
        <div class="vertical">
          <div class="subheader">Promise properties</div>
            <template
              is="dom-repeat"
              items="{{configuration.promise}}"
              filter="[[filterFn]]"
            >
            <paper-item>
              [[item.name]]
              <paper-tooltip>[[item.description]]</paper-tooltip>
            </paper-item>
          </template>
        </div>
      </template>
  </div>
  </template>

  <script>
    /**
     * Missing Description
     * 
     * #appliesMixin 
     * @customElement
     * @polymer
     * @demo demo
     */
    class SandboxConfiguration extends Polymer.Element {

      static get is() { return 'sandbox-configuration'; }

      static get properties() {
        return {
          showPrivate: {
            type: Boolean,
            value: false
          },
          filterFn: {
            type: Function,
            computed: '_computeFilterFn(showPrivate)'
          },
          element: {
            type: Object
          },
          configuration: {
            type: Object,
            value: () => ({})
          }
        };
      }

      _stopEventPropagation(e) {console.log(e);
        e.stopPropagation();
        e.stopImmediatePropagation();
      }

      _uppercaseToSpace(value) {
        return value.replace( /([A-Z])/g, " $1" );
      }

      _toHyphen(value) {
        return value.replace( /([A-Z])/g, "-$1" ).toLowerCase();
      }

      _computeFilterFn(showPrivate) {
        return item => showPrivate || item.privacy != 'protected';
      }

      _handleFunctionButtonTap(e) {
        let model = e.model;
        model.set('item.lastResponse', this.element[model.item.name]());
      }
    }

    window.customElements.define(SandboxConfiguration.is, SandboxConfiguration);

  </script>
</dom-module>
