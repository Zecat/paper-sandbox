<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../paper-input/paper-input.html">
<!-- <link rel="import" href="../paper-toggle-button/paper-toggle-button.html"> -->
<link rel="import" href="../paper-tooltip/paper-tooltip.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../paper-checkbox/paper-checkbox.html">
<link rel="import" href="../paper-styles/typography.html">
<link rel="import" href="paper-sandbox-method.html">

<!--
`sandbox-configuration`


-->

<dom-module id="sandbox-configuration">
  <template strip-whitespace>
    <style>
      :host {
        display: block;
        @apply --layout-vertical;
      }
      .section {
        @apply --layout-horizontal;
        @apply --layout-wrap;
        padding: 24px 42px;
        border-top: 1px solid var(--paper-grey-200);
      }
      :host .section:nth-of-type(2n) {
        background: var(--paper-grey-100);
      }
      :host .section:nth-of-type(2n + 1) {
        background: var(--paper-grey-50);
      }
      .subheader {
        display: none;
        @apply --paper-font-subhead;
      }
      paper-sandbox-method {
        margin:  8px;
        width: 200px;
      }
      .booleans paper-checkbox {
        padding: 12px;
        border-right: 1px solid var(--paper-grey-300);
        width: 164px;
        text-align: center;
      }
      paper-input {
        padding: 8px 12px;
      }
      
    </style>

    <!-- TODO: give the tooltips a better style using prism-hightlighter -->

      <template is="dom-if" if="[[configuration.methods.length]]">
        <div class="section methods">
          <div class="subheader">Methods</div>
          <template
            is="dom-repeat"
            items="{{configuration.methods}}"
            filter="[[filterFn]]"
          >
            <paper-sandbox-method
                name="[[item.name]]"
                description="[[item.description]]"
                params="{{item.params}}"
                on-method-triggered="_methodTriggeredHandler">
            </paper-sandbox-method>
          </template>
        </div>
      </template>

      <!-- IDEA: Experiment grid layout on this -->
      <template is="dom-if" if="[[configuration.properties.boolean.length]]">
        <div class="section booleans">
          <div class="subheader">Boolean properties</div>
          <template
            is="dom-repeat"
            items="{{configuration.properties.boolean}}"
            filter="[[filterFn]]"
          >
            <paper-checkbox checked="{{item.value}}">[[_toHyphen(item.name)]]</paper-checkbox>
              <!-- <paper-tooltip>[[item.description]]</paper-tooltip> -->
          </template>
        </div>
      </template>

      <template is="dom-if" if="[[configuration.properties.string.length]]">
        <div class="section">
          <div class="subheader">String properties</div>
          <template
            is="dom-repeat"
            items="{{configuration.properties.string}}"
            filter="[[filterFn]]"
          >
            <paper-input label="[[_toHyphen(item.name)]]" value="{{item.value}}"></paper-input>
            <!-- <paper-tooltip>[[item.description]]</paper-tooltip> -->
          </template>
        </div>
      </template>

      <template is="dom-if" if="[[configuration.properties.number.length]]">
        <div class="section">
          <div class="subheader">Number properties</div>
          <template
            is="dom-repeat"
            items="{{configuration.properties.number}}"
            filter="[[filterFn]]"
          >
            <paper-input label="[[_toHyphen(item.name)]]" value="{{item.value}}"></paper-input>
            <!-- <paper-tooltip>[[item.description]]</paper-tooltip> -->
          </template>
        </div>
      </template>

      <template is="dom-if" if="[[configuration.event.length]]">
        <div class="section">
          <div class="subheader">Events</div>
          <template
            is="dom-repeat"
            items="{{configuration.event}}"
          >
            <paper-item>
              [[item.name]]
              <!-- <paper-tooltip>[[item.description]]</paper-tooltip> -->
            </paper-item>
          </template>
        </div>
      </template>

  </template>

  <script>
    /**
     * Missing Description
     * 
     * #appliesMixin 
     * @customElement
     * @polymer
     */
    class SandboxConfiguration extends Polymer.Element {

      static get is() { return 'sandbox-configuration'; }

      static get properties() {
        return {
          showPrivate: {
            type: Boolean,
            value: false
          },
          filterFn: {
            type: Function,
            computed: '_computeFilterFn(showPrivate)'
          },
          element: {
            type: Object
          },
          configuration: {
            type: Object,
            notify: true
          }
        };
      }

      _stopEventPropagation(e) {console.log(e);
        e.stopPropagation();
        e.stopImmediatePropagation();
      }

      _uppercaseToSpace(value) {
        return value.replace( /([A-Z])/g, " $1" );
      }

      _toHyphen(value) {
        return value.replace( /([A-Z])/g, "-$1" ).toLowerCase();
      }

      _computeFilterFn(showPrivate) {
        return item => showPrivate || item.privacy != 'protected';
      }

      _methodTriggeredHandler(e) {
        const {model} = e, {item: {name, params}} = model;
        model.set('item.lastResponse', this.element[name](...params.map(p => p.value)));
      }
    }

    window.customElements.define(SandboxConfiguration.is, SandboxConfiguration);

  </script>
</dom-module>
