<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../paper-input/paper-input.html">
<!-- <link rel="import" href="../paper-toggle-button/paper-toggle-button.html"> -->
<link rel="import" href="../paper-tooltip/paper-tooltip.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../paper-checkbox/paper-checkbox.html">
<link rel="import" href="../paper-styles/typography.html">
<link rel="import" href="paper-sandbox-method.html">

<!--
`sandbox-configuration`


-->

<dom-module id="sandbox-configuration">
  <template strip-whitespace>
    <style>
      :host {
        display: block;
      }
      #bindedProps {
        @apply --layout-horizontal;
      }
      .vertical {
        @apply --layout-vertical;
      }
      .subheader {
        @apply --paper-font-subhead;
      }
      
    </style>

    <!-- TODO: give the tooltips a better style using prism-hightlighter -->
    <div id="bindedProps">

      <template is="dom-if" if="[[configuration.methods.length]]">
        <div class="vertical methods">
          <div class="subheader">Methods</div>
          <template
            is="dom-repeat"
            items="{{configuration.methods}}"
            filter="[[filterFn]]"
          >
            <paper-sandbox-method
                name="[[item.name]]"
                description="[[item.description]]"
                params="{{item.params}}"
                on-method-triggered="_methodTriggeredHandler">
            </paper-sandbox-method>
          </template>
        </div>
      </template>

      <template is="dom-if" if="[[configuration.properties.boolean.length]]">
        <div class="vertical">
          <div class="subheader">Boolean properties</div>
          <template
            is="dom-repeat"
            items="{{configuration.properties.boolean}}"
            filter="[[filterFn]]"
          >
            <paper-item>
              <paper-checkbox checked="{{item.value}}">[[_toHyphen(item.name)]]</paper-checkbox>
              <paper-tooltip>[[item.description]]</paper-tooltip>
            </paper-item>
          </template>
        </div>
      </template>

      <template is="dom-if" if="[[configuration.properties.string.length]]">
        <div class="vertical">
          <div class="subheader">String properties</div>
          <template
            is="dom-repeat"
            items="{{configuration.properties.string}}"
            filter="[[filterFn]]"
          >
            <paper-item>
            <paper-input label="[[_toHyphen(item.name)]]" value="{{item.value}}"></paper-input>
            <paper-tooltip>[[item.description]]</paper-tooltip>
          </paper-item>
          </template>
        </div>
      </template>

      <template is="dom-if" if="[[configuration.properties.number.length]]">
        <div class="vertical">
          <div class="subheader">Number properties</div>
          <template
            is="dom-repeat"
            items="{{configuration.properties.number}}"
            filter="[[filterFn]]"
          >
            <paper-item>
            <paper-input label="[[_toHyphen(item.name)]]" value="{{item.value}}"></paper-input>
            <paper-tooltip>[[item.description]]</paper-tooltip>
          </paper-item>
          </template>
        </div>
      </template>

      <template is="dom-if" if="[[configuration.event.length]]">
        <div class="vertical">
          <div class="subheader">Events</div>
          <template
            is="dom-repeat"
            items="{{configuration.event}}"
          >
            <paper-item>
              [[item.name]]
              <paper-tooltip>[[item.description]]</paper-tooltip>
            </paper-item>
          </template>
        </div>
      </template>

      <template is="dom-if" if="[[configuration.event.length]]">
        <div class="vertical">
          <div class="subheader">Events fired</div>
          <template
            is="dom-repeat"
            items="{{configuration.fired}}"
          >
            <paper-item>
              [[item.name]]
              <paper-tooltip>[[item.detail]]</paper-tooltip>
            </paper-item>
          </template>
        </div>
      </template>

      <template is="dom-if" if="[[configuration.promise]]">
        <div class="vertical">
          <div class="subheader">Promise properties</div>
            <template
              is="dom-repeat"
              items="{{configuration.promise}}"
              filter="[[filterFn]]"
            >
            <paper-item>
              [[item.name]]
              <paper-tooltip>[[item.description]]</paper-tooltip>
            </paper-item>
          </template>
        </div>
      </template>
  </div>
  </template>

  <script>
    /**
     * Missing Description
     * 
     * #appliesMixin 
     * @customElement
     * @polymer
     */
    class SandboxConfiguration extends Polymer.Element {

      static get is() { return 'sandbox-configuration'; }

      static get properties() {
        return {
          showPrivate: {
            type: Boolean,
            value: false
          },
          filterFn: {
            type: Function,
            computed: '_computeFilterFn(showPrivate)'
          },
          element: {
            type: Object
          },
          configuration: {
            type: Object,
            notify: true
          }
        };
      }

      _stopEventPropagation(e) {console.log(e);
        e.stopPropagation();
        e.stopImmediatePropagation();
      }

      _uppercaseToSpace(value) {
        return value.replace( /([A-Z])/g, " $1" );
      }

      _toHyphen(value) {
        return value.replace( /([A-Z])/g, "-$1" ).toLowerCase();
      }

      _computeFilterFn(showPrivate) {
        return item => showPrivate || item.privacy != 'protected';
      }

      _methodTriggeredHandler(e) {
        let model = e.model;
        model.set('item.lastResponse', this.element[model.item.name]());
      }
    }

    window.customElements.define(SandboxConfiguration.is, SandboxConfiguration);

  </script>
</dom-module>
